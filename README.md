## Описание
Проект представляет собой решение поставленного компанией [YADRO](https://yadro.com/) тестового задания.

## Задание
### Требования к решению
Требуется написать прототип системы, которая следит за работой компьютерного клуба, обрабатывает события и подсчитывает 
выручку за день и время занятости каждого стола. Решением задания будет: файл или несколько файлов с исходным кодом 
программы на языке **_C++_**(стандарт до  **_C++20_** включительно), инструкции по сборке и тестовые примеры (количество тестов — на усмотрение разработчика).

Входные данные представляют собой текстовый файл. Файл указывается первым аргументом при запуске программы.

Пример запуска программы:
```bash
$ task.exe test_file.txt
```
где **task.exe** — имя исполняемого файла (может быть любым), **test_file.txt** — имя файла с входными данными
(произвольно задаётся пользователем).

Программа должна компилироваться компилятором **gcc** или **clang** в **Linux**, **mingw**/**cygwin** в **Windows**.
Рекомендуется использование стандартной библиотеки (**STL**). Использование любых сторонних библиотек, кроме **STL**,
запрещено. В решении, кроме файлов с исходным кодом, требуется предоставить инструкции по компиляции программы для 
проверки. Можно, но необязательно, использовать следующие системы автоматизации сборки: **make**, **automake**, 
**cmake**, **gradle**; проприетарные средства сборки не допускаются: например, файлы проектов _MS Visual Studio_ 
не подойдут.

Можно (но необязательно) написать дополнительно проверочные юнит-тесты с использованием доступной библиотеки 
(**Google Test**, **CppUTest**, и т.п.).

### Формат входных данных
<количество столов в компьютерном клубе>\
<время начала работы> <время окончания работы>\
<стоимость часа в компьютерном клубе>\
<время события 1> <идентификатор события 1> <тело события 1>\
<время события 2> <идентификатор события 2> <тело события 2>\
...\
<время события N> <идентификатор события N> <тело события N>

Первая строка содержит количество столов в виде целого положительного числа.\
Во второй строке задаётся время начала и окончания работы компьютерного клуба, разделённые пробелом.\
В третьей строке задаётся стоимость часа в компьютерном клубе в виде целого положительного числа.\
Затем задаётся список входящих событий, разделённых переносом строки. Внутри строки в качестве разделителя между 
элементами используется один пробел.

- Имена клиентов представляют собой комбинацию символов из алфавита a..z, 0..9, _, -.
- Время задаётся в 24-часовом формате с двоеточием в качестве разделителя XX:XX,
незначащие нули обязательны при вводе и выводе (например 15:03 или 08:09).
- Каждый стол имеет свой номер от 1 до M, где M - общее число столов, указанное в конфигурации.
- Все события идут последовательно во времени (время события N+1) >= (время события N).

### Выходные данные
Если входные данные не удовлетворяют описанному формату, программа должна вывести в консоль первую строку, 
в которой найдена ошибка формата, вывести подсказку, в чём может быть ошибка, и завершиться.

Если входные данные корректны, программа должна вывести следующий результат:

- На первой строке выводится время начала работы.
- Далее перечислены все события, произошедшие за рабочий день (входящие и исходящие), каждое на отдельной строке.
- После списка событий на отдельной строке выводится время окончания работы.
- Для каждого стола на отдельной строке выведены через пробел следующие параметры: Номер стола, Выручка за день и 
Время, которое он был занят в течение рабочего дня.

После этого программа должна завершиться.

### Подсчёт выручки
За каждый час, проведённый за столом, клиент платит цену, указанную в конфигурации. При оплате время округляется до 
часа в большую сторону, поэтому даже если клиент занимал стол всего несколько минут, он платит за целый час. Выручка - 
сумма, полученная ото всех клиентов за всё время работы компьютерного клуба.

### События
Все события характеризуются временем и идентификатором события. Исходящие события - это события, создаваемые во время
работы программы. События, относящиеся к категории "входящие", сгенерированы быть не могут и выводятся в том же виде, 
в котором были поданы во входном файле.

### Входящие события
**ID 1. Клиент пришёл**\
Формат: <время> 1 <имя клиента>\
Если клиент уже в компьютерном клубе, генерируется ошибка "YouShallNotPass".\
Если клиент пришёл в нерабочие часы, генерируется ошибка "NotOpenYet".

**ID 2. Клиент сел за стол**\
Формат: <время> 2 <имя клиента> <номер стола>\
Если клиент уже сидит за столом, то он может сменить стол.\
Если стол <номер стола> занят (в том числе, если клиент пытается пересесть за стол, за которым сам и сидит), 
генерируется ошибка "PlaceIsBusy".\
Если клиент не находится в компьютерном клубе, генерируется ошибка "ClientUnknown".

**ID 3. Клиент ожидает**\
Формат: <время> 3 <имя клиента>\
Если клиент не находится в компьютерном клубе, генерируется ошибка "ClientUnknown".\
Если в клубе есть свободные столы, то генерируется ошибка "ICanWaitNoLonger!".\
Если клиент уже находится в очереди ожидания, генерируется ошибка "ClientIsAlreadyWaiting!"\
Если клиент уже сел за стол, генерируется ошибка "ClientHasAlreadySatDownAtTheTable!"\
Если в очереди ожидания клиентов больше, чем общее число столов, то клиент уходит и генерируется событие **ID 11**.

**ID 4. Клиент ушёл**\
Формат: <время> 4 <имя клиента>\
Если клиент не находится в компьютерном клубе, генерируется ошибка "ClientUnknown".\
Когда клиент уходит, стол, за которым он сидел, освобождается и его занимает первый клиент из очереди ожидания 
(**ID 12**).

### Исходящие события
**ID 11. Клиент ушел**\
Формат: <время> 11 <имя клиента>\
Генерируется в конце рабочего дня для всех клиентов, оставшихся в компьютерном клубе, в алфавитном порядке их имен. 
А также, когда клиент встаёт в очередь, а очередь ожидания уже заполнена.

**ID 12. Клиент сел за стол**\
Формат: <время> 12 <имя клиента> <номер стола>\
Генерируется для первого клиента в очереди при освобождении любого стола.

**ID 13. Ошибка**\
Формат: <время> 13 <ошибка>\
Выводится сразу после события, которое вызвало ошибку. Событие, вызвавшее ошибку, считается не выполненным, 
и никакого эффекта на состояние клиентов не оказывает.

### Пример работы программы
<table>
    <thead>
        <tr>
            <th>Входной файл</th>
            <th>Вывод в консоль</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td align="left" valign="top">3<br/>09:00 19:00<br/>10<br/>08:48 1 client1<br/>09:41 1 client1<br/>09:48 1 client2<br/>09:52 3 client1<br/>09:54 2 client1 1<br/>10:25 2 client2 2<br/>10:58 1 client3<br/>10:59 2 client3 3<br/>11:30 1 client4<br/>11:35 2 client4 2<br/>11:45 3 client4<br/>12:33 4 client1<br/>12:43 4 client2<br/>15:52 4 client4<br/><br/><br/><br/><br/><br/><br/><br/></td>
            <td align="left" valign="top">09:00<br/>08:48 1 client1<br/>08:48 13 NotOpenYet<br/>09:41 1 client1<br/>09:48 1 client2<br/>09:52 3 client1<br/>09:52 13 ICanWaitNoLonger!<br/>09:54 2 client1 1<br/>10:25 2 client2 2<br/>10:58 1 client3<br/>10:59 2 client3 3<br/>11:30 1 client4<br/>11:35 2 client4 2<br/>11:35 13 PlaceIsBusy<br/>11:45 3 client4<br/>12:33 4 client1<br/>12:33 12 client4 1<br/>12:43 4 client2<br/>15:52 4 client4<br/>19:00 11 client3<br/>19:00<br/>1 70 05:58<br/>2 30 02:18<br/>3 90 08:01</td>
        </tr>
    </tbody>
</table>

## Программная реализация
Для решения поставленного [задания](#задание) использовались следующие средства разработки:
- [C++20](https://en.cppreference.com/w/cpp/20);
- [CMake](https://cmake.org/);
- [ninja 1.10.2](https://github.com/ninja-build/ninja).

## Тестирование
Для тестирования использовался фреймворк [Catch2](https://github.com/catchorg/Catch2) версии
[3.3.2](https://github.com/catchorg/Catch2/releases/tag/v3.3.2).

Для проведения тестирования был разработан следующий набор тестовых сценариев:
- [Обработка файла с некорректным расширением](test/YadroComputerClubTest.cpp#L29);
- [Обработка несуществующего файла](test/YadroComputerClubTest.cpp#L33);
- [Обработка пустого файла](test/YadroComputerClubTest.cpp#L42);
- [Обработка файла с некорректным числом столов в клубе](test/YadroComputerClubTest.cpp#L46);
- [Обработка файла с некорректным разделителем в часах работы клуба](test/YadroComputerClubTest.cpp#L50);
- [Обработка файла с некорректным временем открытия клуба](test/YadroComputerClubTest.cpp#L55);
- [Обработка файла с некорректным временем закрытия клуба](test/YadroComputerClubTest.cpp#L59);
- [Обработка файла с некорректной стоимостью часа в компьютерном клубе](test/YadroComputerClubTest.cpp#L63);
- [Обработка файла без разделителей в описании события](test/YadroComputerClubTest.cpp#L67);
- [Обработка файла с одним разделителем в описании события](test/YadroComputerClubTest.cpp#L71);
- [Обработка файла с некорректным временем события](test/YadroComputerClubTest.cpp#L76);
- [Обработка файла с некорректным идентификатором события](test/YadroComputerClubTest.cpp#L80);
- [Обработка файла с некорректным телом события с идентификатором 2](test/YadroComputerClubTest.cpp#L84);
- [Обработка файла с некорректным именем клиента в описании события](test/YadroComputerClubTest.cpp#L89);
- [Обработка файла с некорректным номером стола в описании события 
с идентификатором 2](test/YadroComputerClubTest.cpp#L93);
- [Обработка правильно заданного файла](test/YadroComputerClubTest.cpp#L98);
- [Обработка файла, в котором время открытия клуба не меньше времени закрытия](test/YadroComputerClubTest.cpp#L108);
- [Обработка файла, в котором номер стола в событии с идентификатором 2 превышает 
число столов в клубе](test/YadroComputerClubTest.cpp#L113);
- [Обработка файла, в котором время события не меньше времени закрытия клуба](test/YadroComputerClubTest.cpp#L118);
- [Обработка файла, в котором нарушена правильная временная 
последовательность событий](test/YadroComputerClubTest.cpp#L123);
- [Проверка результата работы клуба, если на вход поступает файл, в котором случаются 
все события и все виды ошибок](test/YadroComputerClubTest.cpp#L141);
- [Проверка результата работы клуба, если на вход поступает файл, 
в котором не случаются ошибки](test/YadroComputerClubTest.cpp#L165);
- [Проверка результата работы клуба по тестовому файлу, взятому из описания 
технического задания](test/YadroComputerClubTest.cpp#L195);
- [Проверка правильности печати тестового файла, взятого из описания 
технического задания](test/YadroComputerClubTest.cpp#L219).

## Сборка и запуск
Для сборки (сборка основного бинарника и тестов) нужно, находясь в корне проекта, запустить следующую команду:
- **Windows**:
    ```bash
    .\build.sh
    ```
- **Linux**:
    ```bash
    $ sudo chmod +x build.sh
    $ ./build.sh
    ```

Запуск:
- Основная программа:
    - **Windows**:
      ```bash
      cd build/src
      YadroComputerClub.exe <path_to_txt_file>
      ```
    - **Linux**:
      ```bash
      $ cd build/src
      $ ./YadroComputerClub <path_to_txt_file>
      ```
- Тесты:
    - **Windows**:
      ```bash
      cd build/test
      YadroComputerClubTest.exe
      ```
    - **Linux**:
      ```bash
      $ cd build/test
      $ ./YadroComputerClubTest
      ```